-- Fix: Remove duplicate freelancer sections and add only once after CTA
-- First, restore the original content without freelancer sections

UPDATE posts 
SET content = REGEXP_REPLACE(
    content,
    '<!-- Freelancer Application Section -->.*?</script>',
    '',
    'gs'
)
WHERE slug = 'homepage';

-- Now add the freelancer section only once, right after the CTA section
UPDATE posts 
SET content = REPLACE(
    content,
    '<!-- CTA -->
<section class="py-32 relative bg-slate-900" id="iletisim">',
    '<!-- CTA -->
<section class="py-32 relative bg-slate-900" id="iletisim">'
)
WHERE slug = 'homepage';

-- Add freelancer section after the closing of CTA section (id="iletisim")
UPDATE posts 
SET content = REGEXP_REPLACE(
    content,
    '(</section>)(\s*)(</script>)',
    E'\\1\n\n<!-- Freelancer Application Section -->\n<section class="py-32 bg-gradient-to-br from-slate-50 to-white relative overflow-hidden" id="freelancer-basvuru">\n    <!-- Decorative Elements -->\n    <div class="absolute top-0 right-0 w-96 h-96 bg-brand-100/30 rounded-full blur-3xl"></div>\n    <div class="absolute bottom-0 left-0 w-96 h-96 bg-cyan-100/30 rounded-full blur-3xl"></div>\n    \n    <div class="container mx-auto px-4 relative z-10">\n        <div class="max-w-5xl mx-auto">\n            <!-- Header -->\n            <div class="text-center mb-16">\n                <span class="text-brand-600 font-black tracking-[0.2em] uppercase text-xs mb-6 block">Ekibimize Katıl</span>\n                <h2 class="font-heading font-black text-4xl md:text-6xl text-slate-900 mb-8">Freelancer Olarak Sisteme Katıl</h2>\n                <p class="text-slate-600 text-xl lg:text-2xl font-light leading-relaxed max-w-3xl mx-auto">\n                    Profesyonel mekan fotoğrafçısı mısınız? Ekibimize katılın ve Türkiye\'\'nin dört bir yanındaki projelerden pay alın.\n                </p>\n            </div>\n\n            <!-- Form -->\n            <div class="bg-white rounded-[3rem] shadow-2xl p-8 md:p-12 border border-slate-100">\n                <form id="freelancer-form" class="space-y-8">\n                    <!-- Name and Email Row -->\n                    <div class="grid md:grid-cols-2 gap-6">\n                        <div>\n                            <label for="freelancer-name" class="block text-sm font-bold text-slate-700 mb-3">\n                                Ad Soyad <span class="text-red-500">*</span>\n                            </label>\n                            <input \n                                type="text" \n                                id="freelancer-name" \n                                name="name" \n                                required\n                                class="w-full px-6 py-4 rounded-2xl border-2 border-slate-200 focus:border-brand-500 focus:ring-4 focus:ring-brand-100 transition-all outline-none text-slate-900 font-medium"\n                                placeholder="Adınız ve soyadınız"\n                            >\n                        </div>\n                        <div>\n                            <label for="freelancer-email" class="block text-sm font-bold text-slate-700 mb-3">\n                                E-posta <span class="text-red-500">*</span>\n                            </label>\n                            <input \n                                type="email" \n                                id="freelancer-email" \n                                name="email" \n                                required\n                                class="w-full px-6 py-4 rounded-2xl border-2 border-slate-200 focus:border-brand-500 focus:ring-4 focus:ring-brand-100 transition-all outline-none text-slate-900 font-medium"\n                                placeholder="ornek@email.com"\n                            >\n                        </div>\n                    </div>\n\n                    <!-- Phone and City Row -->\n                    <div class="grid md:grid-cols-2 gap-6">\n                        <div>\n                            <label for="freelancer-phone" class="block text-sm font-bold text-slate-700 mb-3">\n                                Telefon <span class="text-red-500">*</span>\n                            </label>\n                            <input \n                                type="tel" \n                                id="freelancer-phone" \n                                name="phone" \n                                required\n                                class="w-full px-6 py-4 rounded-2xl border-2 border-slate-200 focus:border-brand-500 focus:ring-4 focus:ring-brand-100 transition-all outline-none text-slate-900 font-medium"\n                                placeholder="0555 123 45 67"\n                            >\n                        </div>\n                        <div>\n                            <label for="freelancer-city" class="block text-sm font-bold text-slate-700 mb-3">\n                                Bulunduğunuz Şehir <span class="text-red-500">*</span>\n                            </label>\n                            <input \n                                type="text" \n                                id="freelancer-city" \n                                name="city" \n                                required\n                                class="w-full px-6 py-4 rounded-2xl border-2 border-slate-200 focus:border-brand-500 focus:ring-4 focus:ring-brand-100 transition-all outline-none text-slate-900 font-medium"\n                                placeholder="Örn: Antalya"\n                            >\n                        </div>\n                    </div>\n\n                    <!-- Experience -->\n                    <div>\n                        <label for="freelancer-experience" class="block text-sm font-bold text-slate-700 mb-3">\n                            Deneyim Yılı <span class="text-red-500">*</span>\n                        </label>\n                        <select \n                            id="freelancer-experience" \n                            name="experience" \n                            required\n                            class="w-full px-6 py-4 rounded-2xl border-2 border-slate-200 focus:border-brand-500 focus:ring-4 focus:ring-brand-100 transition-all outline-none text-slate-900 font-medium"\n                        >\n                            <option value="">Seçiniz...</option>\n                            <option value="0-1">0-1 yıl</option>\n                            <option value="1-3">1-3 yıl</option>\n                            <option value="3-5">3-5 yıl</option>\n                            <option value="5-10">5-10 yıl</option>\n                            <option value="10+">10+ yıl</option>\n                        </select>\n                    </div>\n\n                    <!-- Specialization -->\n                    <div>\n                        <label class="block text-sm font-bold text-slate-700 mb-3">\n                            Uzmanlık Alanlarınız <span class="text-red-500">*</span>\n                        </label>\n                        <div class="grid md:grid-cols-3 gap-4">\n                            <label class="flex items-center gap-3 p-4 rounded-xl border-2 border-slate-200 hover:border-brand-300 cursor-pointer transition-all">\n                                <input type="checkbox" name="specialization[]" value="mimari" class="w-5 h-5 text-brand-600 rounded focus:ring-brand-500">\n                                <span class="text-slate-700 font-medium">Mimari</span>\n                            </label>\n                            <label class="flex items-center gap-3 p-4 rounded-xl border-2 border-slate-200 hover:border-brand-300 cursor-pointer transition-all">\n                                <input type="checkbox" name="specialization[]" value="ic-mekan" class="w-5 h-5 text-brand-600 rounded focus:ring-brand-500">\n                                <span class="text-slate-700 font-medium">İç Mekan</span>\n                            </label>\n                            <label class="flex items-center gap-3 p-4 rounded-xl border-2 border-slate-200 hover:border-brand-300 cursor-pointer transition-all">\n                                <input type="checkbox" name="specialization[]" value="otel" class="w-5 h-5 text-brand-600 rounded focus:ring-brand-500">\n                                <span class="text-slate-700 font-medium">Otel</span>\n                            </label>\n                            <label class="flex items-center gap-3 p-4 rounded-xl border-2 border-slate-200 hover:border-brand-300 cursor-pointer transition-all">\n                                <input type="checkbox" name="specialization[]" value="emlak" class="w-5 h-5 text-brand-600 rounded focus:ring-brand-500">\n                                <span class="text-slate-700 font-medium">Emlak</span>\n                            </label>\n                            <label class="flex items-center gap-3 p-4 rounded-xl border-2 border-slate-200 hover:border-brand-300 cursor-pointer transition-all">\n                                <input type="checkbox" name="specialization[]" value="yemek" class="w-5 h-5 text-brand-600 rounded focus:ring-brand-500">\n                                <span class="text-slate-700 font-medium">Yemek</span>\n                            </label>\n                            <label class="flex items-center gap-3 p-4 rounded-xl border-2 border-slate-200 hover:border-brand-300 cursor-pointer transition-all">\n                                <input type="checkbox" name="specialization[]" value="drone" class="w-5 h-5 text-brand-600 rounded focus:ring-brand-500">\n                                <span class="text-slate-700 font-medium">Drone</span>\n                            </label>\n                        </div>\n                    </div>\n\n                    <!-- Portfolio URL -->\n                    <div>\n                        <label for="freelancer-portfolio" class="block text-sm font-bold text-slate-700 mb-3">\n                            Portfolio / Instagram Linki\n                        </label>\n                        <input \n                            type="url" \n                            id="freelancer-portfolio" \n                            name="portfolio" \n                            class="w-full px-6 py-4 rounded-2xl border-2 border-slate-200 focus:border-brand-500 focus:ring-4 focus:ring-brand-100 transition-all outline-none text-slate-900 font-medium"\n                            placeholder="https://instagram.com/kullaniciadi veya portfolio linki"\n                        >\n                    </div>\n\n                    <!-- Message -->\n                    <div>\n                        <label for="freelancer-message" class="block text-sm font-bold text-slate-700 mb-3">\n                            Kendinizden Bahsedin\n                        </label>\n                        <textarea \n                            id="freelancer-message" \n                            name="message" \n                            rows="5"\n                            class="w-full px-6 py-4 rounded-2xl border-2 border-slate-200 focus:border-brand-500 focus:ring-4 focus:ring-brand-100 transition-all outline-none text-slate-900 font-medium resize-none"\n                            placeholder="Deneyimleriniz, ekipmanlarınız ve neden ekibimize katılmak istediğiniz hakkında kısaca bilgi verin..."\n                        ></textarea>\n                    </div>\n\n                    <!-- Submit Button -->\n                    <div class="text-center pt-4">\n                        <button \n                            type="submit" \n                            class="group relative px-16 py-6 bg-brand-600 hover:bg-brand-500 text-white rounded-[2rem] font-black text-xl shadow-[0_20px_50px_rgba(14,165,233,0.4)] transition-all hover:scale-105 active:scale-95 overflow-hidden"\n                        >\n                            <span class="relative z-10">Başvurumu Gönder</span>\n                            <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000"></div>\n                        </button>\n                        <p class="text-sm text-slate-500 mt-6">\n                            Başvurunuz en kısa sürede değerlendirilecek ve size dönüş yapılacaktır.\n                        </p>\n                    </div>\n                </form>\n\n                <!-- Success Message (Hidden by default) -->\n                <div id="freelancer-success" class="hidden text-center py-12">\n                    <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">\n                        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="text-green-600">\n                            <polyline points="20 6 9 17 4 12"></polyline>\n                        </svg>\n                    </div>\n                    <h3 class="text-3xl font-black text-slate-900 mb-4">Başvurunuz Alındı!</h3>\n                    <p class="text-slate-600 text-lg">Teşekkür ederiz. En kısa sürede sizinle iletişime geçeceğiz.</p>\n                </div>\n            </div>\n        </div>\n    </div>\n</section>\n\n<script>\ndocument.addEventListener("DOMContentLoaded", function() {\n    const form = document.getElementById("freelancer-form");\n    const successMessage = document.getElementById("freelancer-success");\n    \n    if (form) {\n        form.addEventListener("submit", async function(e) {\n            e.preventDefault();\n            \n            const formData = new FormData(form);\n            const data = {\n                name: formData.get("name"),\n                email: formData.get("email"),\n                phone: formData.get("phone"),\n                city: formData.get("city"),\n                experience: formData.get("experience"),\n                specialization: formData.getAll("specialization[]"),\n                portfolio: formData.get("portfolio"),\n                message: formData.get("message"),\n                type: "freelancer_application"\n            };\n            \n            // Validate specialization\n            if (data.specialization.length === 0) {\n                alert("Lütfen en az bir uzmanlık alanı seçiniz.");\n                return;\n            }\n            \n            try {\n                const response = await fetch("/api/freelancer-application.php", {\n                    method: "POST",\n                    headers: {\n                        "Content-Type": "application/json"\n                    },\n                    body: JSON.stringify(data)\n                });\n                \n                if (response.ok) {\n                    form.style.display = "none";\n                    successMessage.classList.remove("hidden");\n                    \n                    // Scroll to success message\n                    successMessage.scrollIntoView({ behavior: "smooth", block: "center" });\n                } else {\n                    alert("Bir hata oluştu. Lütfen daha sonra tekrar deneyiniz.");\n                }\n            } catch (error) {\n                console.error("Form submission error:", error);\n                alert("Bir hata oluştu. Lütfen daha sonra tekrar deneyiniz.");\n            }\n        });\n    }\n});\n</script>\n\n\\2\\3',
    'g'
)
WHERE slug = 'homepage' 
AND content LIKE '%id="iletisim"%'
AND content NOT LIKE '%id="freelancer-basvuru"%';
